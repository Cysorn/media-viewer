<!-- Recursive fragment to handle a single level of buttons -->
<div th:fragment="hierarchyFragment(items, depth)">
    <div th:if="${depth < items.size()}">
        <button class="hierarchy-button" th:text="${items.get(depth).name}"></button>
        <div class="child-buttons" th:if="${depth + 1 < items.size()}">
            <div th:each="subItem : ${items.get(depth).subItems}">
                <div th:replace="_recursiveHierarchy :: hierarchyFragment(${subItem}, ${depth + 1})"></div>
            </div>
        </div>
    </div>
</div>